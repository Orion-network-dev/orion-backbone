frr defaults traditional
log syslog informational
ip forwarding
ip nht resolve-via-default
!
router bgp {{ .ASN }}
 no bgp network import-check
 bgp router-id 192.168.255.{{ .OrionId }}
{{- range .Peers }}
 neighbor orion{{ .OrionId }} interface orion{{ .OrionId }}
 neighbor orion{{ .OrionId }} interface remote-as {{ .ASN }}
 neighbor orion{{ .OrionId }} capability extended-nexthop
 neighbor orion{{ .OrionId }} capability dynamic
{{- end }}
 !
 address-family ipv4 unicast
  network 10.30.{{ .OrionId }}.0/24
{{- range .Peers }}
  neighbor orion{{ .OrionId }} activate
  neighbor orion{{ .OrionId }} route-map orion{{ .ASN }} out
  neighbor orion{{ .OrionId }} route-map orion{{ .ASN }} in
{{- end }}
 exit-address-family
 !
 address-family ipv4 multicast
  network 232.30.{{ .OrionId }}.0/24
{{- range .Peers }}
  neighbor orion{{ .OrionId }} activate
  neighbor orion{{ .OrionId }} route-map orion{{ .ASN }} out
  neighbor orion{{ .OrionId }} route-map orion{{ .ASN }} in
{{- end }}
 exit-address-family
exit
!
{{ range .Groups -}}
route-map orion{{ .ASN }} permit 10
  match ip address prefix-list orion
route-map orion{{ .ASN }} deny 30
{{ end -}}
!
ip prefix-list orion seq 20 permit 10.30.0.0/16 le 32 ge 24
ip prefix-list orion seq 30 permit 232.30.0.0/16 le 32 ge 24
ip route 10.30.0.0/16 reject 255
ip route 10.30.{{ .OrionId }}.0/24 lo 255
!
line vty
!
